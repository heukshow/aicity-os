<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Cauchemar Crew | Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #050505;
            color: #ffffff;
        }

        .neon-purple {
            color: #bf5af2;
            text-shadow: 0 0 10px rgba(191, 90, 242, 0.5);
        }

        .bg-glass {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="antialiased flex items-center justify-center min-h-screen py-20">

    <div class="w-full max-w-md p-8 bg-glass rounded-[40px] border border-white/5 space-y-10">
        <div class="text-center">
            <h1 class="text-4xl font-black tracking-tighter uppercase">CAUCHEMAR CREW <span
                    class="neon-purple">JOIN</span>
            </h1>
        </div>

        <form onsubmit="handleRegister(event)" class="space-y-6">
            <div class="space-y-3">
                <label
                    class="text-sm font-bold text-gray-400 uppercase tracking-widest flex justify-between items-center">
                    Login ID (ZEPETO ID)
                    <span class="text-[10px] lowercase tracking-normal text-gray-400 font-normal">(ë¡œê·¸ì¸ ë° ì œí˜í†  ì•„ì´ë””)</span>
                </label>
                <input type="text" id="zepeto_id"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-xl focus:border-purple-500 focus:outline-none transition"
                    placeholder="ì˜ˆ: oskyoo12" autocomplete="off" required>
            </div>
            <div class="space-y-3">
                <label
                    class="text-sm font-bold text-gray-400 uppercase tracking-widest flex justify-between items-center">
                    ZEPETO Profile URL
                    <span class="text-[10px] lowercase tracking-normal text-gray-400 font-normal">(ì•„ì´ë”” ì…ë ¥ ì‹œ ìë™
                        ìƒì„±)</span>
                </label>
                <input type="text" id="zepeto_url"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-base focus:border-purple-500 focus:outline-none transition"
                    placeholder="https://web.zepeto.me/..." autocomplete="off" required>
                <p class="text-[10px] text-purple-400/60 pl-2">â€» ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ë©´ í”„ë¡œí•„ ë§í¬ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>
            </div>

            <!-- Revenue Settlement Agreement -->
            <div class="space-y-3 pt-4 border-t border-white/10">
                <label class="text-sm font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2">
                    Revenue Settlement Agreement
                    <span class="text-[10px] text-purple-500 bg-purple-500/10 px-2 py-0.5 rounded-full">Required</span>
                </label>
                <div
                    class="w-full h-32 bg-white/5 border border-white/10 rounded-2xl p-4 overflow-y-auto text-[11px] text-gray-400 leading-relaxed scrollbar-thin scrollbar-thumb-white/20">
                    <p class="font-bold text-white mb-2">[ìˆ˜ìµ ë¶„ë°° ë° ì •ì‚° ë™ì˜ì„œ]</p>
                    <p>1. <strong class="text-white">ìˆ˜ìµ ë°°ë¶„:</strong> í¬ë¦¬ì—ì´í„°(ê·€í•˜)ê°€ ì œì‘í•œ ì•„ì´í…œ ë° ì½˜í…ì¸ ë¡œ ë°œìƒí•œ ìˆœìˆ˜ìµì˜ <strong>80%ëŠ”
                            ê·€í•˜ì—ê²Œ, 20%ëŠ” Cauchemar Agencyì—ê²Œ</strong> ê·€ì†ë©ë‹ˆë‹¤.</p>
                    <p class="mt-2">2. <strong class="text-white">ì •ì‚° ì¼ì •:</strong> ì •ì‚°ì€ <strong>ë§¤ì›” 15ì¼</strong>ì— ì§„í–‰ë©ë‹ˆë‹¤. ë‹¨,
                        ì œí˜í†  ë³¸ì‚¬ì˜ ì •ì±…ì´ë‚˜ ì—ì´ì „ì‹œ ë²•ì¸ ê³„ì¢Œì˜ ì´ì²´ í•œë„ ì œí•œì´ ë°œìƒí•  ê²½ìš°, <strong>í•œë„ê°€ í•´ì œë˜ëŠ” ë‹¹ì¼ ë˜ëŠ” ìµì¼</strong>ì— ì¦‰ì‹œ ì§€ê¸‰ë©ë‹ˆë‹¤.</p>
                    <p class="mt-2">3. <strong class="text-white">ê¶Œë¦¬ ë° ì˜ë¬´:</strong> ê·€í•˜ëŠ” ë³¸ ë™ì˜ì— ì„œëª…í•˜ì§€ ì•Šì„ ê²½ìš°, Cauchemar
                        Crewì˜ ì¼ì›ìœ¼ë¡œì„œ ì•„ì´í…œ ì—…ë¡œë“œ ë° í¬íŠ¸í´ë¦¬ì˜¤ ë“±ë¡ í™œë™ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p class="mt-2">4. <strong class="text-white">ì„¸ê¸ˆ:</strong> ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ 3.3%ì˜ ì‚¬ì—…ì†Œë“ì„¸ê°€ ì›ì²œì§•ìˆ˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="flex items-center gap-3 pt-2">
                    <input type="checkbox" id="agree_terms" class="w-5 h-5 accent-purple-500 cursor-pointer rounded">
                    <label for="agree_terms" class="text-xs text-gray-300 select-none cursor-pointer">ìœ„ ì •ì‚° ë‚´ìš©ì— ë™ì˜í•˜ë©°, ì´ë¥¼
                        ì¤€ìˆ˜í•˜ê² ìŠµë‹ˆë‹¤.</label>
                </div>
            </div>

            <div class="space-y-3">
                <label class="text-sm font-bold text-gray-400 uppercase tracking-widest">Creator Type (í¬ë¦¬ì—ì´í„° ìœ í˜•)</label>
                <select id="creator_type"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-lg focus:border-purple-500 focus:outline-none transition [&>option]:bg-black text-white"
                    required>
                    <option value="" disabled selected>ì„ íƒí•´ì£¼ì„¸ìš” / Select your specialty</option>
                    <option value="Item Creator">ğŸ‘• Item Creator (ì•„ì´í…œ ì œì‘)</option>
                    <option value="Video Creator">ğŸ¬ Video Creator (ì˜ìƒ ì œì‘)</option>
                    <option value="Image Creator">ğŸ–¼ï¸ Image Creator (ì´ë¯¸ì§€ ì œì‘)</option>
                    <option value="Live Streamer">ğŸ™ï¸ Live Streamer (ë¼ì´ë¸Œ ë°©ì†¡)</option>
                    <option value="World Builder">ğŸŒ World Builder (ì›”ë“œ ì œì‘)</option>
                    <option value="Multi-Talented Creator">âœ¨ Multi-Talented Creator (ë‹¤ì¬ë‹¤ëŠ¥)</option>
                </select>
            </div>

            <div class="space-y-3">
                <label class="text-sm font-bold text-gray-400 uppercase tracking-widest">Password</label>
                <input type="password" id="password"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-xl focus:border-purple-500 focus:outline-none transition"
                    required>
            </div>
            <div class="space-y-3">
                <label class="text-sm font-bold text-gray-400 uppercase tracking-widest">Confirm Password</label>
                <input type="password" id="password_confirm"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-xl focus:border-purple-500 focus:outline-none transition"
                    required>
            </div>
            <button type="submit"
                class="w-full bg-white text-black font-black py-5 rounded-2xl text-xl hover:bg-purple-400 hover:text-white transition shadow-lg uppercase tracking-tighter">
                Create Account
            </button>
        </form>

        <p class="text-center text-sm text-gray-500">
            Already have an account? <a href="login.html" class="text-purple-400 hover:underline">Log in</a>
        </p>
    </div>

    <script>
        // Auto-fill URL when ID is typed
        document.getElementById('zepeto_id').addEventListener('input', (e) => {
            const id = e.target.value.trim();
            if (id) {
                // Use the user's preferred "share" format for auto-generation
                document.getElementById('zepeto_url').value = `https://web.zepeto.me/share/user/profile/${id}`;
            } else {
                document.getElementById('zepeto_url').value = '';
            }
        });

        // Also allow manual URL extraction if they paste a URL directly into the URL field
        function extractZepetoId(url) {
            try {
                if (!url) return '';
                // Robust extraction: remove query strings first, then take the last path segment
                const cleanUrl = url.trim().split('?')[0];
                const parts = cleanUrl.split('/');
                const id = parts[parts.length - 1];
                return id && id.length > 2 ? id : '';
            } catch (e) {
                return '';
            }
        }

        document.getElementById('zepeto_url').addEventListener('input', (e) => {
            const val = e.target.value.trim();
            if (val.includes('zepeto.me')) {
                const id = extractZepetoId(val);
                if (id) {
                    document.getElementById('zepeto_id').value = id;
                }
            }
        });

        async function handleRegister(e) {
            e.preventDefault();
            const login_id = document.getElementById('zepeto_id').value.trim();
            const zepeto_url = document.getElementById('zepeto_url').value.trim();
            const password = document.getElementById('password').value;
            const passwordConfirm = document.getElementById('password_confirm').value;

            const agreeTerms = document.getElementById('agree_terms').checked;
            const creatorType = document.getElementById('creator_type').value;

            if (!agreeTerms) {
                alert('ìˆ˜ìµ ë¶„ë°° ë° ì •ì‚° ë™ì˜ì„œì— ë™ì˜í•´ì•¼ ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            if (!login_id || !zepeto_url || !password || !creatorType) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.');
                return;
            }

            if (password !== passwordConfirm) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            const zepeto_id = extractZepetoId(zepeto_url) || login_id;

            try {
                const res = await fetch('/api/crew/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: login_id,
                        name: login_id,
                        password,
                        role: creatorType,  // Send selected creator type as role
                        zepeto_id: zepeto_id,
                        zepeto_url: zepeto_url, // Send the full URL for server-side scraping
                        agree_terms: agreeTerms // Send agreement status
                    })
                });

                const result = await res.json();
                if (res.ok) {
                    alert('âœ… ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    window.location.href = 'login.html';
                } else {
                    alert('ê°€ì… ì‹¤íŒ¨: ' + result.message);
                }
            } catch (err) {
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜');
            }
        }
    </script>
</body>

</html>